function ChangedSomeQuestion(n,t,i,r,u,f){for(var h,s,o,e=0;e<n.length;e++)if(n[e].parentName==t)for(h=0;h<formJson.list.length;h++)if(formJson.list[h].name==t)if(formJson.list[h].type=="rate"){if(n[e].showCondition==1)if(i>=n[e].targetValue)u.push(n[e].name),o=r[n[e].name],o.length>0&&ChangedSomeQuestion(n,n[e].name,o[0],r);else for(f.push(n[e].name),s=0;s<n.length;s++)n[s].parentName==n[e].name&&(f.push(n[s].name),o=r[n[e].name],o.length>0&&ChangedSomeQuestion(n,n[e].name,o[0],r));else if(n[e].showCondition==2)if(i<n[e].targetValue)u.push(n[e].name),o=r[n[e].name],o.length>0&&ChangedSomeQuestion(n,n[e].name,o[0],r,u,f);else for(f.push(n[e].name),s=0;s<n.length;s++)n[s].parentName==n[e].name&&(f.push(n[s].name),o=r[n[e].name],o.length>0&&ChangedSomeQuestion(n,n[e].name,o[0],r,u,f))}else i.indexOf(n[e].targetValue)!=-1?(u.push(n[e].name),o=r[n[e].name],o.length>0&&ChangedSomeQuestion(n,n[e].name,o[0],r)):(f.push(n[e].name),o=r[n[e].name],o.length>0&&ChangedSomeQuestion(n,n[e].name,o[0],r))}function Submit(){if(appObj.XQKey==null){parent.$message({message:"请选择校区",type:"warning"});return}if(appObj.YXKey==null){parent.$message({message:"请选择院系",type:"warning"});return}if(appObj.ZYKey==null){parent.$message({message:"请选择专业",type:"warning"});return}if(appObj.BJKey==null){parent.$message({message:"请选择班级",type:"warning"});return}parent.$refs.generateForm.getData().then(n=>{dto.questionnaireItemId=id,dto.questionnaireAnswer=JSON.stringify(n),dto.xQKey=appObj.XQKey,dto.yXKey=appObj.YXKey,dto.zYKey=appObj.ZYKey,dto.bJKey=appObj.BJKey,abp.services.app.questionnaire.submitQuestionnaireAnswer(dto,null).done(function(){abp.message.success("提交成功","",!1);window.location.href="/Survey/TanksForAnswer"}).fail(function(){abp.message.error("提交失败","",!1)})}).catch(()=>{abp.message.error("请完成必填项","",!1)})}var id=window.id,parent=null,dto={},listWhere=null,formJson=null,appObj={loading:!0,XQKey:null,XQKeys:[],YXKey:null,YXKeys:[],ZYKey:null,ZYKeys:[],BJKey:null,BJKeys:[]};$(function(){abp.ui.setBusy("#lockRow");abp.services.app.basicDataMaintenance.getCascaderByKeyword("XQKey",appObj.XQKey,null).done(function(n){appObj.XQKeys=n});abp.services.app.basicDataMaintenance.getCascaderByKeyword("YXKey",appObj.XQKey,null).done(function(n){appObj.YXKeys=n});abp.services.app.questionnaire.getQuestionnaireLinkageListByItemId(id,null).done(function(n){listWhere=n;abp.services.app.questionnaire.getQuestionnaireFormById(id,null).done(function(t){for(var r=[],i=0;i<n.length;i++)r.push(n[i].name);formJson=JSON.parse(t);appObj.jsonData=formJson;parent=new Vue({el:"#app",data:function(){return appObj},methods:{onSomeChanged:function(n,t,i){var r=[],u=[];ChangedSomeQuestion(listWhere,n,t,i,r,u);parent.$refs.generateForm.display(r);parent.$refs.generateForm.hide(u)},onXQChanged:function(){},onYXChanged:function(){appObj.ZYKey=null;appObj.BJKey=null;abp.services.app.basicDataMaintenance.getCascaderByKeywordParent("ZYKey",appObj.YXKey,null).done(function(n){appObj.ZYKeys=n})},onZYChanged:function(){appObj.BJKey=null;abp.services.app.basicDataMaintenance.getCascaderByKeywordParent("BJKey",appObj.ZYKey,null).done(function(n){appObj.BJKeys=n})}}});parent.$refs.generateForm.hide(r);appObj.loading=!1;abp.ui.clearBusy("#lockRow")})})});